<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<link href="../cscroot.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Molengo" />
<script type="text/javascript" src="../cscroot.js"> </script>
<title>ROOT Exercise II</title>
</head>
<body>
<iframe class="toc" src="../toc.html?2.2" > </iframe>
<div id="b">
<h1>ROOT Exercise II</h1>
<h3>Reading a TTree (1/5)</h3>
      <p class="info"> Note that for these exercises, timing is a <em>key ingredient</em>, so please remember the printed times.
      And to be sure to obtain good timing values, you <em>have to</em> run the macro consecutively several (at least two) times.</p>

      <p>Execute <a href="read_tree.C" class="source">read_tree.C<b>+</b></a> (note the plus!).
      Modify the macro to read the muons; use the TBrowser to determine the name of the branch.</p>

<div class="help" id="help1">
<p>You start the browser by <tt>new TBrowser()</tt>.
It shows several branches; the branch that the macro currently reads out ("electrons") is one of them.
All top level branches contain a collection (<tt>TClonesArray</tt>) that themselves contain classes deriving from <tt>MyParticle</tt>.
You can see details in <a href="myparticle.h" class="source">myparticle.h</a>.
When changing read_tree.C to read a different branch, think of the data flow from setting the branch's address to the local variable to reading to filling the histogram: what is different for the muons and the electrons?</p>
</div>

<div class="help" id="help2">
<p>The muons are in the branch called "muons", electrons are in the branch called "electrons".
You will need to set the branch address giving the proper branch name.
You can keep the particles' <tt>TClonesArray</tt> variable because both muon and electron branches contain <tt>TClonesArray</tt>s.
And you can even keep the loop over the particles including the histogram filling because both branches contain a <tt>TClonesArray</tt> of <tt>MyParticle</tt>s.</p>
</div>

<div class="help" id="helps">
<p>Your code should look like this:</p>
<pre>
#include "TROOT.h"
#include "TFile.h"
#include "TTree.h"
#include "TRandom.h"
#include "TClonesArray.h"
#include "myparticle.h"
#include "TH1F.h"

void read_tree()
{
   // function reading particles collection in a tree

   // open the Root file
   TFile *f = TFile::Open("http://server/ROOT/exercise2.root");
   if (!f || f-&gt;IsZombie()) {
      printf("Problem opening http://server/ROOT/exercise2.root \n");
      return;
   }
   // get the tree from the file
   TTree *myTree = (TTree*)f-&gt;Get("MyTree");
   // declare a pointer on a TClonesArray 
   // and initialize it to 0
   TClonesArray *particles = 0;
   // assign the branch to the TClonesArray
   <b>myTree-&gt;SetBranchAddress("muons", &amp;particles);</b>
   
   // initialize Root's timing mechanism
   gROOT-&gt;Time();
   
   // create the 1D histogram of floats 
   // (100 bins, between 0.0 and 10.0)
   TH1F *h1 = new TH1F("h1", "Pt", 100, 0.0, 10.0);
   // get number of entries in the tree
   Long64_t nentries = myTree-&gt;GetEntries();
   // loop over all entries
   for (Long64_t ev=0;ev&lt;nentries;ev++) {
      // get tree entry[ev]
      myTree-&gt;GetEntry(ev);
      // get number of particle in the TClonesArray
      Int_t npart = particles-&gt;GetEntriesFast();
      // loop over all particles
      for (Int_t i=0;i&lt;npart;++i) {
         // get the ith particle
         MyParticle *particle = (MyParticle *)particles-&gt;At(i);
         // fill the histogram with particle's energy value
         h1-&gt;Fill(particle-&gt;fPt);
      }
   }
   // draw (display) the histogram
   h1-&gt;Draw();
   // display the time elapsed since the first call to gROOT-&gt;Time()
   gROOT-&gt;Time();
}
</pre>
</div>

<div id="nav" class="buttons">
  <a href="2.html">
    <span>
    <img src="../img/arrow_left.png" alt="" />
    Back
    </span>
  </a>

  <a href="#" onclick="javascript:help(); return false" id="btnhelp">
    <span>
    <img src="../img/help.png" alt="" />
    Help
    </span>
  </a>

  <a href="4.html">
    <img src="../img/arrow_right.png" alt="" />
    Next
  </a>
</div>

</div>
</body>
</html>
