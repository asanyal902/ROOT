set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})

add_definitions(-DREFLEX_VERSIONING)

MACRO(CONFIGURE_VERSIONING_CXX TARGET)
   
   CONFIGURE_FILE("${REFLEX_TEMPLATES_DIR}/ReflexVersioning.cxx" "${CMAKE_CURRENT_BINARY_DIR}/ReflexVersioning.cxx")

ENDMACRO(CONFIGURE_VERSIONING_CXX)

ADD_SUBDIRECTORY(testLibCommon)
ADD_SUBDIRECTORY(testLibV1)
ADD_SUBDIRECTORY(testLibV2)

INCLUDE_DIRECTORIES(${REFLEX_INCLUDE_DIR} ${CPPUNIT_INCLUDE_DIR} ${CMAKE_CURRENT_SOURCE_DIR}/../legacy ${CMAKE_SOURCE_DIR})

REFLEX_ADD_EXECUTABLE(test_Reflex_versioning TEST test_Reflex_versioning.cxx ${CMAKE_CURRENT_BINARY_DIR}/ReflexVersioning.cxx)

CONFIGURE_VERSIONING_CXX(test_Reflex_versioning)

ADD_DEPENDENCIES(test_Reflex_versioning Reflex)
TARGET_LINK_LIBRARIES(test_Reflex_versioning Reflex ${CPPUNIT_LIBRARY} ${DL_LIBRARY})
REFLEX_ADD_TEST("test_Reflex_versioning" test_Reflex_versioning)
