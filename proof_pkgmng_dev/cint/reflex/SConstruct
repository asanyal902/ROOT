from os import curdir, environ
from os.path import realpath
from sys import platform

opts = Options('custom.py')

opts.Add(BoolOption   ('test',    'Set to 1 if tests shall be compiled', 0))
opts.Add(PathOption   ('prefix',  'The installation directory of Reflex', realpath(curdir)))
opts.Add(PackageOption('gccxml',  'The >binary< directory of gccxml',     'no'))
opts.Add(PackageOption('cppunit', 'The >root< directory of CppUnit',      'no'))

env = Environment(options=opts)

# from http://dev.gentoo.org/~vapier/scons-blows.txt
import SCons.Util

if environ.has_key('CC'):
	env['CC'] = environ['CC']
if environ.has_key('CFLAGS'):
	env['CCFLAGS'] += SCons.Util.CLVar(environ['CFLAGS'])
if environ.has_key('CXX'):
	env['CXX'] = os.environ['CXX']
if environ.has_key('CXXFLAGS'):
	env['CXXFLAGS'] += SCons.Util.CLVar(environ['CXXFLAGS'])
if environ.has_key('LDFLAGS'):
	env['LINKFLAGS'] += SCons.Util.CLVar(environ['LDFLAGS'])

if platform == 'win32': env['CXXFLAGS'] += SCons.Util.CLVar('/EHsc')


Export('env')

Help(opts.GenerateHelpText(env))

SConscript(['src/SConscript',
            'inc/SConscript',
            'python/SConscript'])

if env['test'] : SConscript('test/SConscript')

env.Alias('install', env['prefix'])

